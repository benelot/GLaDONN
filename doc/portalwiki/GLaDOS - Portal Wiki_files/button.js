
var Try={these:function(){var e;for(var t=0,n=arguments.length;t<n;t++){var r=arguments[t];try{e=r();break}catch(i){}}return e}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},request:function(e,t,n){var r=this.getTransport();if(!r)return;if(null!==t&&"function"==typeof t)t.onSuccess=t;else if(!t.onSuccess)return!1;var i=n?"post":t.method?t.method:"get";r.open(i,e,!0),r.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(t.headers)for(header in t.headers)r.setRequestHeader("X-"+header,t.headers[header]);i=="post"&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(r.readyState!=4)return;if(r.status!=200&&r.status!=304){t.onFailure&&t.onFailure(r.status,r.responseText);return}t.onSuccess(r.responseText)};if(r.readyState==4)return;return r.send(n),!0}},FlattrButton={doFlattr:function(e){var t={method:"post",onSuccess:function(t){window.parent.postMessage(JSON.stringify({flattr_button_event:"click_successful"}),"*");var n=document.querySelector(".flattr-count span"),r=parseInt(n.innerHTML)||0;n.innerHTML=++r,e.className="flattr flattr-ed",e.querySelector("span.flattr-link").className="flattr-flattred";var i=e.href.match(/^(.+)\/flattr\/(.+)$/i);e.href=i[1]+"/subscribe/"+i[2],e.title="Subscribe"},onFailure:function(e,t){if(!window.useEvents&&(e==401||e==402)){t=JSON.parse(t),window.parent.location.href=t.url;return}if(e==401||e==402){window.parent.postMessage(JSON.stringify({flattr_button_event:"unauthorized"}),"*");return}window.location.reload(!0)}};Ajax.request(e.href,t)||window.location.reload(!0)},doSubscribe:function(e){var t={method:"post",onSuccess:function(t){window.parent.postMessage(JSON.stringify({flattr_button_event:"subscribe_successful"}),"*");var n=document.createElement("span");n.className="flattr-subscribed";var r=document.createElement("span");r.className="flattr",r.appendChild(n),e.parentNode.replaceChild(r,e)},onFailure:function(e,t){window.location.reload(!0)}};Ajax.request(e.href,t)},init:function(){if(!document.querySelectorAll){var e=document.getElementsByTagName("div")[0];e.parentNode.removeChild(e);return}var t,n,r=document.querySelectorAll(".flattr");for(t=0,n=r.length;t<n;t++)r[t].onclick=function(){return/\bflattr-ajax\b/.test(this.className)?FlattrButton.doFlattr(this):/\bflattr-ed\b/.test(this.className)&&FlattrButton.doSubscribe(this),!1}}};window.onload=function(){FlattrButton.init()}